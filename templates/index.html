<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Encostas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/templates/sensores.html">Sensor 1</a></li>
                <li><a href="#">Sensor 2</a></li>
                <li><a href="#">Sensor 3</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h1>MONITORAMENTO DE ENCOSTAS COM DISPOSITIVO EMBARCADO (IoT)</h1>
            <div class="hero-background">
                Imagem de fundo de uma encosta
            </div>
        </section>

        <section class="map-section">
            <h2>Mapa Georreferenciado de Sensores</h2>
            <div id="map"></div>
        </section>

        <section class="project-info">
            <h2>Sobre o Projeto</h2>
            <p>A eficácia do monitoramento de encostas...  Colocar o conteúdo do projeto aqui.</p>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Monitoramento de Encostas</p>
    </footer>
</body>
</html>-->

<!--INDEX QUE O RONALDO CRIOU-->
<!-- templates/index.html -->

{% extends "layout.html" %}

{% block content %}
<h1 class="text-center text-primary mb-4">SysMonRisk</h1>
<div class="row">
  <!-- Card Data e Hora -->
  <div class="col-md-12 mb-4">
    <div class="card text-center bg-dark text-light">
      <div class="card-header">Data e Hora</div>
      <div class="card-body">
        <h5 class="card-title" id="ultimo_data_hora">{{ ultimo_dado.data_hora }}</h5>
      </div>
    </div>
  </div>

  <!-- Card Umidade -->
  <div class="col-md-4 mb-4">
    <div class="card text-center bg-dark text-light">
      <div class="card-header">Umidade</div>
      <div class="card-body">
        <p class="card-text display-6" id="ultimo_umidade">{{ ultimo_dado.umidade }}%</p>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#humidityModal">Gráficos</button>
      </div>
    </div>
  </div>

  <!-- Card Vibração -->
  <div class="col-md-4 mb-4">
    <div class="card text-center bg-dark text-light">
      <div class="card-header">Vibração</div>
      <div class="card-body">
        <p class="card-text display-6" id="ultimo_vibracao">{{ ultimo_dado.vibracao }} Hz</p>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#vibrationModal">Gráficos</button>
      </div>
    </div>
  </div>

  <!-- Card Deslocamento -->
  <!-- Card Deslocamento -->
  <div class="col-md-4 mb-4">
    <div class="card text-center bg-dark text-light">
      <div class="card-header">Deslocamento</div>
      <div class="card-body">
        <p class="card-text">X: <span id="ultimo_deslocamento_x">{{ ultimo_dado.deslocamento_x }}</span> mm</p>
        <p class="card-text">Y: <span id="ultimo_deslocamento_y">{{ ultimo_dado.deslocamento_y }}</span> mm</p>
        <p class="card-text">Z: <span id="ultimo_deslocamento_z">{{ ultimo_dado.deslocamento_z }}</span> mm</p>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#displacementModal">Gráficos</button>
      </div>
    </div>
  </div>
</div>

<!-- Modais para Gráficos -->
<!-- Modal Umidade -->
<div class="modal fade" id="humidityModal" tabindex="-1" aria-labelledby="humidityModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="humidityModalLabel">Gráfico de Umidade</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <canvas id="humidityChart" width="400" height="200"></canvas>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Vibração -->
<div class="modal fade" id="vibrationModal" tabindex="-1" aria-labelledby="vibrationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="vibrationModalLabel">Gráfico de Vibração</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <canvas id="vibrationChart" width="400" height="200"></canvas>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Deslocamento -->
<div class="modal fade" id="displacementModal" tabindex="-1" aria-labelledby="displacementModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="displacementModalLabel">Gráficos de Deslocamento</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <canvas id="displacementXChart" width="400" height="200"></canvas>
        <canvas id="displacementYChart" width="400" height="200" class="mt-4"></canvas>
        <canvas id="displacementZChart" width="400" height="200" class="mt-4"></canvas>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts para Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let humidityChart, vibrationChart, displacementXChart, displacementYChart, displacementZChart;

  // Função para inicializar os gráficos
  function initCharts(chartData) {
    const ctxHumidity = document.getElementById('humidityChart').getContext('2d');
    humidityChart = new Chart(ctxHumidity, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: 'Umidade (%)',
          data: chartData.umidades,
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1,
          fill: true
        }]
      }
    });

    const ctxVibration = document.getElementById('vibrationChart').getContext('2d');
    vibrationChart = new Chart(ctxVibration, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: 'Vibração (Hz)',
          data: chartData.vibracoes,
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1,
          fill: true
        }]
      }
    });

    const ctxDisplacementX = document.getElementById('displacementXChart').getContext('2d');
    displacementXChart = new Chart(ctxDisplacementX, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: 'Deslocamento X (mm)',
          data: chartData.deslocamentoX,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1,
          fill: true
        }]
      }
    });

    const ctxDisplacementY = document.getElementById('displacementYChart').getContext('2d');
    displacementYChart = new Chart(ctxDisplacementY, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: 'Deslocamento Y (mm)',
          data: chartData.deslocamentoY,
          backgroundColor: 'rgba(153, 102, 255, 0.2)',
          borderColor: 'rgba(153, 102, 255, 1)',
          borderWidth: 1,
          fill: true
        }]
      }
    });

    const ctxDisplacementZ = document.getElementById('displacementZChart').getContext('2d');
    displacementZChart = new Chart(ctxDisplacementZ, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: 'Deslocamento Z (mm)',
          data: chartData.deslocamentoZ,
          backgroundColor: 'rgba(255, 206, 86, 0.2)',
          borderColor: 'rgba(255, 206, 86, 1)',
          borderWidth: 1,
          fill: true
        }]
      }
    });
  }

  // Função para atualizar os dados e gráficos
  function atualizarDados() {
    fetch('/dados-sensores')
      .then(response => response.json())
      .then(data => {
        // Atualiza o último dado na interface
        document.querySelector('.card-title').innerText = data.ultimo_dado.data_hora;

        // Atualiza os gráficos
        humidityChart.data.labels = data.graficos.datas;
        humidityChart.data.datasets[0].data = data.graficos.umidades;
        humidityChart.update();

        vibrationChart.data.labels = data.graficos.datas;
        vibrationChart.data.datasets[0].data = data.graficos.vibracoes;
        vibrationChart.update();

        displacementXChart.data.labels = data.graficos.datas;
        displacementXChart.data.datasets[0].data = data.graficos.deslocamentoX;
        displacementXChart.update();

        displacementYChart.data.labels = data.graficos.datas;
        displacementYChart.data.datasets[0].data = data.graficos.deslocamentoY;
        displacementYChart.update();

        displacementZChart.data.labels = data.graficos.datas;
        displacementZChart.data.datasets[0].data = data.graficos.deslocamentoZ;
        displacementZChart.update();
      })
      .catch(error => console.error('Erro ao buscar dados:', error));
  }

  // Inicializa os gráficos com dados iniciais
  document.addEventListener('DOMContentLoaded', () => {
    const initialChartData = JSON.parse('{{ chart_data | safe }}');
    initCharts(initialChartData);

    // Atualiza os dados a cada 10 segundos
    setInterval(atualizarDados, 10000);
  });

/*
  // Dados dos gráficos passados pelo Flask
  const chartData = JSON.parse('{{ chart_data | safe }}');

  // Gráfico de Umidade
  
  const ctxHumidity = document.getElementById('humidityChart').getContext('2d');
  const humidityChart = new Chart(ctxHumidity, {
      type: 'line',
      data: {
          labels: chartData.datas,
          datasets: [{
              label: 'Umidade (%)',
              data: chartData.umidades,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1,
              fill: true,
          }]
      },
      options: {
          scales: {
              x: {
                  type: 'time',
                  time: {
                      unit: 'minute'
                  },
                  title: {
                      display: true,
                      text: 'Data e Hora'
                  }
              },
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Umidade (%)'
                  }
              }
          }
      }
  });

  // Gráfico de Vibração
  const ctxVibration = document.getElementById('vibrationChart').getContext('2d');
  const vibrationChart = new Chart(ctxVibration, {
      type: 'line',
      data: {
          labels: chartData.datas,
          datasets: [{
              label: 'Vibração (Hz)',
              data: chartData.vibracoes,
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 1,
              fill: true,
          }]
      },
      options: {
          scales: {
              x: {
                  type: 'time',
                  time: {
                      unit: 'minute'
                  },
                  title: {
                      display: true,
                      text: 'Data e Hora'
                  }
              },
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Vibração (Hz)'
                  }
              }
          }
      }
  });

  // Gráficos de Deslocamento X, Y e Z
  const ctxDisplacementX = document.getElementById('displacementXChart').getContext('2d');
  const displacementXChart = new Chart(ctxDisplacementX, {
      type: 'line',
      data: {
          labels: chartData.datas,
          datasets: [{
              label: 'Deslocamento X (mm)',
              data: chartData.deslocamentoX,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1,
              fill: true,
          }]
      },
      options: {
          scales: {
              x: {
                  type: 'time',
                  time: {
                      unit: 'minute'
                  },
                  title: {
                      display: true,
                      text: 'Data e Hora'
                  }
              },
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Deslocamento X (mm)'
                  }
              }
          }
      }
  });

  const ctxDisplacementY = document.getElementById('displacementYChart').getContext('2d');
  const displacementYChart = new Chart(ctxDisplacementY, {
      type: 'line',
      data: {
          labels: chartData.datas,
          datasets: [{
              label: 'Deslocamento Y (mm)',
              data: chartData.deslocamentoY,
              backgroundColor: 'rgba(153, 102, 255, 0.2)',
              borderColor: 'rgba(153, 102, 255, 1)',
              borderWidth: 1,
              fill: true,
          }]
      },
      options: {
          scales: {
              x: {
                  type: 'time',
                  time: {
                      unit: 'minute'
                  },
                  title: {
                      display: true,
                      text: 'Data e Hora'
                  }
              },
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Deslocamento Y (mm)'
                  }
              }
          }
      }
  });

  const ctxDisplacementZ = document.getElementById('displacementZChart').getContext('2d');
  const displacementZChart = new Chart(ctxDisplacementZ, {
      type: 'line',
      data: {
          labels: chartData.datas,
          datasets: [{
              label: 'Deslocamento Z (mm)',
              data: chartData.deslocamentoZ,
              backgroundColor: 'rgba(255, 206, 86, 0.2)',
              borderColor: 'rgba(255, 206, 86, 1)',
              borderWidth: 1,
              fill: true,
          }]
      },
      options: {
          scales: {
              x: {
                  type: 'time',
                  time: {
                      unit: 'minute'
                  },
                  title: {
                      display: true,
                      text: 'Data e Hora'
                  }
              },
              y: {
                  beginAtZero: true,
                  title: {
                      display: true,
                      text: 'Deslocamento Z (mm)'
                  }
              }
          }
      }
  });
  // Função para criar gráficos
  function createChart(ctx, label, data, unit) {
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: chartData.datas,
        datasets: [{
          label: `${label} (${unit})`,
          data: data,
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1,
          fill: true
        }]
      },
      options: {
        scales: {
          x: {
            type: 'time',
            time: { unit: 'minute' },
            title: { display: true, text: 'Data e Hora' }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: `${label} (${unit})` }
          }
        }
      }
    });
  }

// Inicialização dos gráficos
  const ctxHumidity = document.getElementById('humidityChart').getContext('2d');
  const humidityChart = createChart(ctxHumidity, 'Umidade', chartData.umidades, '%');

  const ctxVibration = document.getElementById('vibrationChart').getContext('2d');
  const vibrationChart = createChart(ctxVibration, 'Vibração', chartData.vibracoes, 'Hz');

  const ctxDisplacementX = document.getElementById('displacementXChart').getContext('2d');
  const displacementXChart = createChart(ctxDisplacementX, 'Deslocamento X', chartData.deslocamentoX, 'mm');

  const ctxDisplacementY = document.getElementById('displacementYChart').getContext('2d');
  const displacementYChart = createChart(ctxDisplacementY, 'Deslocamento Y', chartData.deslocamentoY, 'mm');

  const ctxDisplacementZ = document.getElementById('displacementZChart').getContext('2d');
  const displacementZChart = createChart(ctxDisplacementZ, 'Deslocamento Z', chartData.deslocamentoZ, 'mm');


  // Função para atualizar os dados dinamicamente
  function updateData() {
    fetch('/update_data')
      .then(response => response.json())
      .then(data => {
        // Atualizar gráficos
        humidityChart.data.labels = data.datas;
        humidityChart.data.datasets[0].data = data.umidades;
        humidityChart.update();

        vibrationChart.data.labels = data.datas;
        vibrationChart.data.datasets[0].data = data.vibracoes;
        vibrationChart.update();

        displacementXChart.data.labels = data.datas;
        displacementXChart.data.datasets[0].data = data.deslocamentoX;
        displacementXChart.update();

        displacementYChart.data.labels = data.datas;
        displacementYChart.data.datasets[0].data = data.deslocamentoY;
        displacementYChart.update();

        displacementZChart.data.labels = data.datas;
        displacementZChart.data.datasets[0].data = data.deslocamentoZ;
        displacementZChart.update();

        // Atualizar os valores mais recentes na interface
        document.getElementById('ultimo_data_hora').textContent = data.datas[data.datas.length - 1];
        document.getElementById('ultimo_umidade').textContent = `${data.umidades[data.umidades.length - 1]}%`;
        document.getElementById('ultimo_vibracao').textContent = `${data.vibracoes[data.vibracoes.length - 1]} Hz`;
        document.getElementById('ultimo_deslocamento_x').textContent = `${data.deslocamentoX[data.deslocamentoX.length - 1]} mm`;
        document.getElementById('ultimo_deslocamento_y').textContent = `${data.deslocamentoY[data.deslocamentoY.length - 1]} mm`;
        document.getElementById('ultimo_deslocamento_z').textContent = `${data.deslocamentoZ[data.deslocamentoZ.length - 1]} mm`;
      })
      .catch(error => console.error('Erro ao atualizar os dados:', error));
  }

  // Atualizar os dados a cada 10 segundos
  setInterval(updateData, 10000);
  */
</script>
{% endblock %}

  
